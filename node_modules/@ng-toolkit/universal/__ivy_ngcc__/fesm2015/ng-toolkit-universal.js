import { Injectable, Inject, PLATFORM_ID, NgModule, InjectionToken } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as ɵngcc0 from '@angular/core';
class WindowService {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        if (!isPlatformBrowser(platformId)) {
            // const req: any = this.injector.get(this.injector.get(USERAGENTTOKEN));
            // this._window = {navigator: {userAgent: req.get('User-Agent')}};
            this._window = (/** @type {?} */ ({ navigator: { userAgent: 'fakeAgent' } }));
        }
        else {
            this._window = window;
        }
    }
    /**
     * @return {?}
     */
    get nativeWindow() {
        return this._window;
    }
}
WindowService.ɵfac = function WindowService_Factory(t) { return new (t || WindowService)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
WindowService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: WindowService, factory: WindowService.ɵfac });
/** @nocollapse */
WindowService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowService, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class LocalStorageWrapper {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        if (isPlatformBrowser(platformId)) {
            this.localStorageRef = localStorage;
        }
        else {
            this.localStorageRef = {
                clear: () => { },
                getItem: (key) => (/** @type {?} */ (undefined)),
                key: (index) => (/** @type {?} */ (undefined)),
                removeItem: (key) => { },
                setItem: (key, value) => { },
                length: 0
            };
        }
    }
    /**
     * @return {?}
     */
    get localStorage() {
        return this.localStorageRef;
    }
}
LocalStorageWrapper.ɵfac = function LocalStorageWrapper_Factory(t) { return new (t || LocalStorageWrapper)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
LocalStorageWrapper.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: LocalStorageWrapper, factory: LocalStorageWrapper.ɵfac });
/** @nocollapse */
LocalStorageWrapper.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LocalStorageWrapper, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class DocumentService {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        if (!isPlatformBrowser(platformId)) {
            this._document = (/** @type {?} */ ((/** @type {?} */ ({
                getElementById: (id) => new HTMLElement(),
                getElementsByClassName: (className) => new HTMLCollection(),
                getElementsByName: (name) => new NodeList(),
                getElementsByTagName: (name) => new NodeList()
            }))));
        }
        else {
            console.log('in browser, assigning document');
            // this._document = document;
            this._document = (/** @type {?} */ ({}));
        }
    }
    /**
     * @return {?}
     */
    get nativeDocument() {
        console.log('get native document');
        console.log(this._document);
        return this._document;
    }
}
DocumentService.ɵfac = function DocumentService_Factory(t) { return new (t || DocumentService)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
DocumentService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DocumentService, factory: DocumentService.ɵfac });
/** @nocollapse */
DocumentService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DocumentService, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
const WINDOW = new InjectionToken('ng-toolkit-window');
/**
 * @param {?} windowService
 * @return {?}
 */
function windowFactory(windowService) {
    return windowService.nativeWindow;
}
/** @type {?} */
const LOCAL_STORAGE = new InjectionToken('ng-toolkit-local-storage');
/**
 * @param {?} localStorageWrapper
 * @return {?}
 */
function localStorageFactory(localStorageWrapper) {
    return localStorageWrapper.localStorage;
}
/** @type {?} */
const NGT_DOCUMENT = new InjectionToken('ng-toolkit-document');
/**
 * @param {?} documentService
 * @return {?}
 */
function documentFactory(documentService) {
    console.log('document factory');
    return documentService.nativeDocument;
}
class NgtUniversalModule {
}
NgtUniversalModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NgtUniversalModule });
NgtUniversalModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NgtUniversalModule_Factory(t) { return new (t || NgtUniversalModule)(); }, providers: [
        WindowService,
        { provide: WINDOW, useFactory: windowFactory, deps: [WindowService] },
        DocumentService,
        { provide: NGT_DOCUMENT, useFactory: documentFactory, deps: [DocumentService] },
        LocalStorageWrapper,
        { provide: LOCAL_STORAGE, useFactory: localStorageFactory, deps: [LocalStorageWrapper] }
    ] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgtUniversalModule, [{
        type: NgModule,
        args: [{
                providers: [
                    WindowService,
                    { provide: WINDOW, useFactory: windowFactory, deps: [WindowService] },
                    DocumentService,
                    { provide: NGT_DOCUMENT, useFactory: documentFactory, deps: [DocumentService] },
                    LocalStorageWrapper,
                    { provide: LOCAL_STORAGE, useFactory: localStorageFactory, deps: [LocalStorageWrapper] }
                ]
            }]
    }], null, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

export { windowFactory, localStorageFactory, documentFactory, WINDOW, LOCAL_STORAGE, NGT_DOCUMENT, NgtUniversalModule, DocumentService, LocalStorageWrapper as ɵb, WindowService as ɵa };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctdG9vbGtpdC11bml2ZXJzYWwuanMiLCJzb3VyY2VzIjpbIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC93aW5kb3cuc2VydmljZS50cyIsIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC9sb2NhbC1zdG9yYWdlLXdyYXBwZXIuc2VydmljZS50cyIsIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC9kb2N1bWVudC5zZXJ2aWNlLnRzIiwibmc6L0BuZy10b29sa2l0L3VuaXZlcnNhbC9uZ3QtdW5pdmVyc2FsL25ndC11bml2ZXJzYWwubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxNQUlhLGFBQWE7QUFKMUIsTUFJYSxhQUFhO0FBQzFCO0FBQ0ksWUFBaUMsVUFBZSx0QkFENUM7S0FFQSxMQURBO0NBQ0ksQ0FBQyxpQkFBaUIsQ0FBQyxwQkFEZixJQUFaLFlBQWlDLFVBQWU7QUFDWCxDQUFDLEVBQUUsSEFBNUMsUUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDNUM7a0RBRVksSUFBSSxDQUFDLE9BQU8sOURBRHhCO0tBQzJCLEVBQUMsU0FBUyxFQUFFLEVBQUMsU0FBUyxFQUFFLFdBQVcsRUFBQyxFQUFDLEVBQVUsQ0FBQyxVQUNsRSxjQUFNLGNBQ0gsdkZBRlosWUFBWSxJQUFJLENBQUMsT0FBTyxzQkFBRyxFQUFDLFNBQVMsRUFBRSxFQUFDLFNBQVMsRUFBRSxXQUFXLEVBQUMsRUFBQyxFQUFVLENBQUM7QUFFM0QsQ0FBQyxPQUFPLFJBRHhCLFNBQVM7Q0FDa0IsTUFBTSxDQUFDLFJBRHhCLGFBQUs7R0FFTixNQUNKLFRBRkwsWUFBWSxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztBQUNsQyxTQUFTO0lBR0wsSkFGSixLQUFLO0VBRUcsRkFEUjtNQUNvQixOQUFiO0FBQ0MsT0FBTyxQQURXO0dBQ1AsQ0FB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bmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgV2luZG93U2VydmljZSB7XG4gICAgcHJpdmF0ZSBfd2luZG93OiBXaW5kb3c7XG4gICAgY29uc3RydWN0b3IoQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZDogYW55KSB7XG4gICAgICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIocGxhdGZvcm1JZCkpIHtcbiAgICAgICAgICAgIC8vIGNvbnN0IHJlcTogYW55ID0gdGhpcy5pbmplY3Rvci5nZXQodGhpcy5pbmplY3Rvci5nZXQoVVNFUkFHRU5UVE9LRU4pKTtcbiAgICAgICAgICAgIC8vIHRoaXMuX3dpbmRvdyA9IHtuYXZpZ2F0b3I6IHt1c2VyQWdlbnQ6IHJlcS5nZXQoJ1VzZXItQWdlbnQnKX19O1xuICAgICAgICAgICAgdGhpcy5fd2luZG93ID0ge25hdmlnYXRvcjoge3VzZXJBZ2VudDogJ2Zha2VBZ2VudCd9fSBhcyBXaW5kb3c7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl93aW5kb3cgPSB3aW5kb3c7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgbmF0aXZlV2luZG93KCk6IGFueSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93aW5kb3c7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTG9jYWxTdG9yYWdlV3JhcHBlciB7XG4gICAgcHJpdmF0ZSBsb2NhbFN0b3JhZ2VSZWY7XG5cbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkKSB7XG4gICAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3NlcihwbGF0Zm9ybUlkKSkge1xuICAgICAgICAgICAgdGhpcy5sb2NhbFN0b3JhZ2VSZWYgPSBsb2NhbFN0b3JhZ2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxvY2FsU3RvcmFnZVJlZiA9IHtcbiAgICAgICAgICAgIGNsZWFyOiAoKSA9PiB7Lypub29wKi99LFxuICAgICAgICAgICAgZ2V0SXRlbTogKGtleTogc3RyaW5nKSA9PiB1bmRlZmluZWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAga2V5OiAoaW5kZXg6IG51bWJlcikgPT4gdW5kZWZpbmVkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHJlbW92ZUl0ZW06IChrZXk6IHN0cmluZykgPT4gey8qbm9vcCovfSxcbiAgICAgICAgICAgIHNldEl0ZW06IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4gey8qbm9vcCovfSxcbiAgICAgICAgICAgIGxlbmd0aDogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBsb2NhbFN0b3JhZ2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsU3RvcmFnZVJlZjtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QsIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEb2N1bWVudFNlcnZpY2Uge1xuICAgIHByaXZhdGUgX2RvY3VtZW50OiBEb2N1bWVudDtcbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkOiBhbnkpIHtcbiAgICAgICAgaWYgKCFpc1BsYXRmb3JtQnJvd3NlcihwbGF0Zm9ybUlkKSkge1xuICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnQgPSA8dW5rbm93bj4ge1xuICAgICAgICAgICAgICAgIGdldEVsZW1lbnRCeUlkOiAoaWQ6IHN0cmluZykgPT4gbmV3IEhUTUxFbGVtZW50KCksXG4gICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZTogKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBuZXcgSFRNTENvbGxlY3Rpb24oKSxcbiAgICAgICAgICAgICAgICBnZXRFbGVtZW50c0J5TmFtZTogKG5hbWU6IHN0cmluZykgPT4gbmV3IE5vZGVMaXN0KCksXG4gICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWU6IChuYW1lOiBzdHJpbmcpID0+IG5ldyBOb2RlTGlzdCgpXG4gICAgICAgICAgICB9IGFzIERvY3VtZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2luIGJyb3dzZXIsIGFzc2lnbmluZyBkb2N1bWVudCcpO1xuICAgICAgICAgICAgLy8gdGhpcy5fZG9jdW1lbnQgPSBkb2N1bWVudDtcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50ID0ge30gYXMgRG9jdW1lbnQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgbmF0aXZlRG9jdW1lbnQoKTogRG9jdW1lbnQge1xuICAgICAgICBjb25zb2xlLmxvZygnZ2V0IG5hdGl2ZSBkb2N1bWVudCcpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLl9kb2N1bWVudCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9kb2N1bWVudDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBOZ01vZHVsZSwgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFdpbmRvd1NlcnZpY2UgfSBmcm9tICcuL3dpbmRvdy5zZXJ2aWNlJztcbmltcG9ydCB7IExvY2FsU3RvcmFnZVdyYXBwZXIgfSBmcm9tICcuL2xvY2FsLXN0b3JhZ2Utd3JhcHBlci5zZXJ2aWNlJztcbmltcG9ydCB7IERvY3VtZW50U2VydmljZSB9IGZyb20gJy4vZG9jdW1lbnQuc2VydmljZSc7XG5cbmV4cG9ydCAqIGZyb20gJy4vZG9jdW1lbnQuc2VydmljZSc7XG5cbmV4cG9ydCBjb25zdCBXSU5ET1cgPSBuZXcgSW5qZWN0aW9uVG9rZW4oJ25nLXRvb2xraXQtd2luZG93Jyk7XG5cbmV4cG9ydCBmdW5jdGlvbiB3aW5kb3dGYWN0b3J5KHdpbmRvd1NlcnZpY2U6IFdpbmRvd1NlcnZpY2UpIHtcbiAgICByZXR1cm4gd2luZG93U2VydmljZS5uYXRpdmVXaW5kb3c7XG59XG5cbmV4cG9ydCBjb25zdCBMT0NBTF9TVE9SQUdFID0gbmV3IEluamVjdGlvblRva2VuKCduZy10b29sa2l0LWxvY2FsLXN0b3JhZ2UnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGxvY2FsU3RvcmFnZUZhY3RvcnkobG9jYWxTdG9yYWdlV3JhcHBlcjogTG9jYWxTdG9yYWdlV3JhcHBlcikge1xuICAgIHJldHVybiBsb2NhbFN0b3JhZ2VXcmFwcGVyLmxvY2FsU3RvcmFnZTtcbn1cblxuZXhwb3J0IGNvbnN0IE5HVF9ET0NVTUVOVCA9IG5ldyBJbmplY3Rpb25Ub2tlbignbmctdG9vbGtpdC1kb2N1bWVudCcpO1xuXG5leHBvcnQgZnVuY3Rpb24gZG9jdW1lbnRGYWN0b3J5KGRvY3VtZW50U2VydmljZTogRG9jdW1lbnRTZXJ2aWNlKSB7XG4gICAgY29uc29sZS5sb2coJ2RvY3VtZW50IGZhY3RvcnknKTtcbiAgICByZXR1cm4gZG9jdW1lbnRTZXJ2aWNlLm5hdGl2ZURvY3VtZW50O1xufVxuXG5ATmdNb2R1bGUoe1xuICAgIHByb3ZpZGVyczogW1xuICAgICAgICBXaW5kb3dTZXJ2aWNlLFxuICAgICAgICB7IHByb3ZpZGU6IFdJTkRPVywgdXNlRmFjdG9yeTogd2luZG93RmFjdG9yeSwgZGVwczogW1dpbmRvd1NlcnZpY2VdIH0sXG4gICAgICAgIERvY3VtZW50U2VydmljZSxcbiAgICAgICAgeyBwcm92aWRlOiBOR1RfRE9DVU1FTlQsIHVzZUZhY3Rvcnk6IGRvY3VtZW50RmFjdG9yeSwgZGVwczogW0RvY3VtZW50U2VydmljZV0gfSxcbiAgICAgICAgTG9jYWxTdG9yYWdlV3JhcHBlcixcbiAgICAgICAgeyBwcm92aWRlOiBMT0NBTF9TVE9SQUdFLCB1c2VGYWN0b3J5OiBsb2NhbFN0b3JhZ2VGYWN0b3J5LCBkZXBzOiBbTG9jYWxTdG9yYWdlV3JhcHBlcl0gfVxuICAgIF1cbn0pXG5leHBvcnQgY2xhc3MgTmd0VW5pdmVyc2FsTW9kdWxlIHt9XG4iXX0=