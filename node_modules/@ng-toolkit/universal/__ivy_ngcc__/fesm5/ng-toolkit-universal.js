import { Injectable, Inject, PLATFORM_ID, NgModule, InjectionToken } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as ɵngcc0 from '@angular/core';
var WindowService = /** @class */ (function () {
    function WindowService(platformId) {
        if (!isPlatformBrowser(platformId)) {
            // const req: any = this.injector.get(this.injector.get(USERAGENTTOKEN));
            // this._window = {navigator: {userAgent: req.get('User-Agent')}};
            this._window = (/** @type {?} */ ({ navigator: { userAgent: 'fakeAgent' } }));
        }
        else {
            this._window = window;
        }
    }
    Object.defineProperty(WindowService.prototype, "nativeWindow", {
        get: /**
         * @return {?}
         */
        function () {
            return this._window;
        },
        enumerable: true,
        configurable: true
    });
    /** @nocollapse */
    WindowService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
WindowService.ɵfac = function WindowService_Factory(t) { return new (t || WindowService)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
WindowService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: WindowService, factory: function (t) { return WindowService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowService, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();
    return WindowService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var LocalStorageWrapper = /** @class */ (function () {
    function LocalStorageWrapper(platformId) {
        if (isPlatformBrowser(platformId)) {
            this.localStorageRef = localStorage;
        }
        else {
            this.localStorageRef = {
                clear: function () { },
                getItem: function (key) { return (/** @type {?} */ (undefined)); },
                key: function (index) { return (/** @type {?} */ (undefined)); },
                removeItem: function (key) { },
                setItem: function (key, value) { },
                length: 0
            };
        }
    }
    Object.defineProperty(LocalStorageWrapper.prototype, "localStorage", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localStorageRef;
        },
        enumerable: true,
        configurable: true
    });
    /** @nocollapse */
    LocalStorageWrapper.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
LocalStorageWrapper.ɵfac = function LocalStorageWrapper_Factory(t) { return new (t || LocalStorageWrapper)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
LocalStorageWrapper.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: LocalStorageWrapper, factory: function (t) { return LocalStorageWrapper.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LocalStorageWrapper, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();
    return LocalStorageWrapper;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
var DocumentService = /** @class */ (function () {
    function DocumentService(platformId) {
        if (!isPlatformBrowser(platformId)) {
            this._document = (/** @type {?} */ ((/** @type {?} */ ({
                getElementById: function (id) { return new HTMLElement(); },
                getElementsByClassName: function (className) { return new HTMLCollection(); },
                getElementsByName: function (name) { return new NodeList(); },
                getElementsByTagName: function (name) { return new NodeList(); }
            }))));
        }
        else {
            console.log('in browser, assigning document');
            // this._document = document;
            this._document = (/** @type {?} */ ({}));
        }
    }
    Object.defineProperty(DocumentService.prototype, "nativeDocument", {
        get: /**
         * @return {?}
         */
        function () {
            console.log('get native document');
            console.log(this._document);
            return this._document;
        },
        enumerable: true,
        configurable: true
    });
    /** @nocollapse */
    DocumentService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
DocumentService.ɵfac = function DocumentService_Factory(t) { return new (t || DocumentService)(ɵngcc0.ɵɵinject(PLATFORM_ID)); };
DocumentService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DocumentService, factory: function (t) { return DocumentService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DocumentService, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();
    return DocumentService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
var WINDOW = new InjectionToken('ng-toolkit-window');
/**
 * @param {?} windowService
 * @return {?}
 */
function windowFactory(windowService) {
    return windowService.nativeWindow;
}
/** @type {?} */
var LOCAL_STORAGE = new InjectionToken('ng-toolkit-local-storage');
/**
 * @param {?} localStorageWrapper
 * @return {?}
 */
function localStorageFactory(localStorageWrapper) {
    return localStorageWrapper.localStorage;
}
/** @type {?} */
var NGT_DOCUMENT = new InjectionToken('ng-toolkit-document');
/**
 * @param {?} documentService
 * @return {?}
 */
function documentFactory(documentService) {
    console.log('document factory');
    return documentService.nativeDocument;
}
var NgtUniversalModule = /** @class */ (function () {
    function NgtUniversalModule() {
    }
NgtUniversalModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NgtUniversalModule });
NgtUniversalModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NgtUniversalModule_Factory(t) { return new (t || NgtUniversalModule)(); }, providers: [
        WindowService,
        { provide: WINDOW, useFactory: windowFactory, deps: [WindowService] },
        DocumentService,
        { provide: NGT_DOCUMENT, useFactory: documentFactory, deps: [DocumentService] },
        LocalStorageWrapper,
        { provide: LOCAL_STORAGE, useFactory: localStorageFactory, deps: [LocalStorageWrapper] }
    ] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgtUniversalModule, [{
        type: NgModule,
        args: [{
                providers: [
                    WindowService,
                    { provide: WINDOW, useFactory: windowFactory, deps: [WindowService] },
                    DocumentService,
                    { provide: NGT_DOCUMENT, useFactory: documentFactory, deps: [DocumentService] },
                    LocalStorageWrapper,
                    { provide: LOCAL_STORAGE, useFactory: localStorageFactory, deps: [LocalStorageWrapper] }
                ]
            }]
    }], function () { return []; }, null); })();
    return NgtUniversalModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

export { windowFactory, localStorageFactory, documentFactory, WINDOW, LOCAL_STORAGE, NGT_DOCUMENT, NgtUniversalModule, DocumentService, LocalStorageWrapper as ɵb, WindowService as ɵa };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctdG9vbGtpdC11bml2ZXJzYWwuanMiLCJzb3VyY2VzIjpbIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC93aW5kb3cuc2VydmljZS50cyIsIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC9sb2NhbC1zdG9yYWdlLXdyYXBwZXIuc2VydmljZS50cyIsIm5nOi9AbmctdG9vbGtpdC91bml2ZXJzYWwvbmd0LXVuaXZlcnNhbC9kb2N1bWVudC5zZXJ2aWNlLnRzIiwibmc6L0BuZy10b29sa2l0L3VuaXZlcnNhbC9uZ3QtdW5pdmVyc2FsL25ndC11bml2ZXJzYWwubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtZQU1JLHVCQUFpQyxVQUFlLDdDQU5wRDtRQU9RLElBQUksQ0FBQyxpQkFBaUIsQ0FBQywvQkFQa0IsSUFNN0MsdUJBQWlDLFVBQWU7QUFDWCxDQUFDLEVBQUUsSEFBNUMsUUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDNUM7a0RBRVksSUFBSSxDQUFDLE9BQU8sOURBRHhCO0tBQzJCLEVBQUMsU0FBUyxFQUFFLEVBQUMsU0FBUyxFQUFFLFdBQVcsRUFBQyxFQUFDLEVBQVUsQ0FBQyxVQUNsRSxjQUFNLGNBQ0gsdkZBRlosWUFBWSxJQUFJLENBQUMsT0FBTyxzQkFBRyxFQUFDLFNBQVMsRUFBRSxFQUFDLFNBQVMsRUFBRSxXQUFXLEVBQUMsRUFBQyxFQUFVLENBQUM7QUFFM0QsQ0FBQyxPQUFPLFJBRHhCLFNBQVM7Q0FDa0IsTUFBTSxDQUFDLFJBRHhCLGFBQUs7R0FFTixNQUNKLEtBRUQsZEFKSixZQUFZLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0NBSTFCLERBSFIsU0FBUztBQUNULEtBQUs7d0JBRWUseEJBRHBCLElBQ0ksc0JBQUksdUNBQVk7QUFBSTtFQUFwQixGQUNPO0tBQUgsTEFDSDtBQURVLElBQUksQ0FBQyxP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LG1CQUFtQjtBQUNuQixFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7T0FBVSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsc0JBQzNGO0VBQ0o7Ozs7Ozs7Ozs7Ozs7Z0RBQ1M7QUFBQyxJQUFzQix5QkFBQztBQUNqQyxDQURpQztBQUM5QjtBQUFDO0FBQUk7QUFBa0M7QUFBZ0Y7QUFBSTtBQUFDO0FBQUk7QUFBa0M7QUFBZ0Y7QUFBSTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBQTEFURk9STV9JRCwgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFdpbmRvd1NlcnZpY2Uge1xuICAgIHByaXZhdGUgX3dpbmRvdzogV2luZG93O1xuICAgIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHBsYXRmb3JtSWQ6IGFueSkge1xuICAgICAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHBsYXRmb3JtSWQpKSB7XG4gICAgICAgICAgICAvLyBjb25zdCByZXE6IGFueSA9IHRoaXMuaW5qZWN0b3IuZ2V0KHRoaXMuaW5qZWN0b3IuZ2V0KFVTRVJBR0VOVFRPS0VOKSk7XG4gICAgICAgICAgICAvLyB0aGlzLl93aW5kb3cgPSB7bmF2aWdhdG9yOiB7dXNlckFnZW50OiByZXEuZ2V0KCdVc2VyLUFnZW50Jyl9fTtcbiAgICAgICAgICAgIHRoaXMuX3dpbmRvdyA9IHtuYXZpZ2F0b3I6IHt1c2VyQWdlbnQ6ICdmYWtlQWdlbnQnfX0gYXMgV2luZG93O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IG5hdGl2ZVdpbmRvdygpOiBhbnkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2luZG93O1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIExvY2FsU3RvcmFnZVdyYXBwZXIge1xuICAgIHByaXZhdGUgbG9jYWxTdG9yYWdlUmVmO1xuXG4gICAgY29uc3RydWN0b3IoQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZCkge1xuICAgICAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIocGxhdGZvcm1JZCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9jYWxTdG9yYWdlUmVmID0gbG9jYWxTdG9yYWdlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2NhbFN0b3JhZ2VSZWYgPSB7XG4gICAgICAgICAgICBjbGVhcjogKCkgPT4gey8qbm9vcCovfSxcbiAgICAgICAgICAgIGdldEl0ZW06IChrZXk6IHN0cmluZykgPT4gdW5kZWZpbmVkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIGtleTogKGluZGV4OiBudW1iZXIpID0+IHVuZGVmaW5lZCBhcyBzdHJpbmcsXG4gICAgICAgICAgICByZW1vdmVJdGVtOiAoa2V5OiBzdHJpbmcpID0+IHsvKm5vb3AqL30sXG4gICAgICAgICAgICBzZXRJdGVtOiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpID0+IHsvKm5vb3AqL30sXG4gICAgICAgICAgICBsZW5ndGg6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgbG9jYWxTdG9yYWdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbFN0b3JhZ2VSZWY7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRTZXJ2aWNlIHtcbiAgICBwcml2YXRlIF9kb2N1bWVudDogRG9jdW1lbnQ7XG4gICAgY29uc3RydWN0b3IoQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZDogYW55KSB7XG4gICAgICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIocGxhdGZvcm1JZCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50ID0gPHVua25vd24+IHtcbiAgICAgICAgICAgICAgICBnZXRFbGVtZW50QnlJZDogKGlkOiBzdHJpbmcpID0+IG5ldyBIVE1MRWxlbWVudCgpLFxuICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlDbGFzc05hbWU6IChjbGFzc05hbWU6IHN0cmluZykgPT4gbmV3IEhUTUxDb2xsZWN0aW9uKCksXG4gICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeU5hbWU6IChuYW1lOiBzdHJpbmcpID0+IG5ldyBOb2RlTGlzdCgpLFxuICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlUYWdOYW1lOiAobmFtZTogc3RyaW5nKSA9PiBuZXcgTm9kZUxpc3QoKVxuICAgICAgICAgICAgfSBhcyBEb2N1bWVudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpbiBicm93c2VyLCBhc3NpZ25pbmcgZG9jdW1lbnQnKTtcbiAgICAgICAgICAgIC8vIHRoaXMuX2RvY3VtZW50ID0gZG9jdW1lbnQ7XG4gICAgICAgICAgICB0aGlzLl9kb2N1bWVudCA9IHt9IGFzIERvY3VtZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IG5hdGl2ZURvY3VtZW50KCk6IERvY3VtZW50IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2dldCBuYXRpdmUgZG9jdW1lbnQnKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5fZG9jdW1lbnQpO1xuICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnQ7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgTmdNb2R1bGUsIEluamVjdGlvblRva2VuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBXaW5kb3dTZXJ2aWNlIH0gZnJvbSAnLi93aW5kb3cuc2VydmljZSc7XG5pbXBvcnQgeyBMb2NhbFN0b3JhZ2VXcmFwcGVyIH0gZnJvbSAnLi9sb2NhbC1zdG9yYWdlLXdyYXBwZXIuc2VydmljZSc7XG5pbXBvcnQgeyBEb2N1bWVudFNlcnZpY2UgfSBmcm9tICcuL2RvY3VtZW50LnNlcnZpY2UnO1xuXG5leHBvcnQgKiBmcm9tICcuL2RvY3VtZW50LnNlcnZpY2UnO1xuXG5leHBvcnQgY29uc3QgV0lORE9XID0gbmV3IEluamVjdGlvblRva2VuKCduZy10b29sa2l0LXdpbmRvdycpO1xuXG5leHBvcnQgZnVuY3Rpb24gd2luZG93RmFjdG9yeSh3aW5kb3dTZXJ2aWNlOiBXaW5kb3dTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHdpbmRvd1NlcnZpY2UubmF0aXZlV2luZG93O1xufVxuXG5leHBvcnQgY29uc3QgTE9DQUxfU1RPUkFHRSA9IG5ldyBJbmplY3Rpb25Ub2tlbignbmctdG9vbGtpdC1sb2NhbC1zdG9yYWdlJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2NhbFN0b3JhZ2VGYWN0b3J5KGxvY2FsU3RvcmFnZVdyYXBwZXI6IExvY2FsU3RvcmFnZVdyYXBwZXIpIHtcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlV3JhcHBlci5sb2NhbFN0b3JhZ2U7XG59XG5cbmV4cG9ydCBjb25zdCBOR1RfRE9DVU1FTlQgPSBuZXcgSW5qZWN0aW9uVG9rZW4oJ25nLXRvb2xraXQtZG9jdW1lbnQnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGRvY3VtZW50RmFjdG9yeShkb2N1bWVudFNlcnZpY2U6IERvY3VtZW50U2VydmljZSkge1xuICAgIGNvbnNvbGUubG9nKCdkb2N1bWVudCBmYWN0b3J5Jyk7XG4gICAgcmV0dXJuIGRvY3VtZW50U2VydmljZS5uYXRpdmVEb2N1bWVudDtcbn1cblxuQE5nTW9kdWxlKHtcbiAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgV2luZG93U2VydmljZSxcbiAgICAgICAgeyBwcm92aWRlOiBXSU5ET1csIHVzZUZhY3Rvcnk6IHdpbmRvd0ZhY3RvcnksIGRlcHM6IFtXaW5kb3dTZXJ2aWNlXSB9LFxuICAgICAgICBEb2N1bWVudFNlcnZpY2UsXG4gICAgICAgIHsgcHJvdmlkZTogTkdUX0RPQ1VNRU5ULCB1c2VGYWN0b3J5OiBkb2N1bWVudEZhY3RvcnksIGRlcHM6IFtEb2N1bWVudFNlcnZpY2VdIH0sXG4gICAgICAgIExvY2FsU3RvcmFnZVdyYXBwZXIsXG4gICAgICAgIHsgcHJvdmlkZTogTE9DQUxfU1RPUkFHRSwgdXNlRmFjdG9yeTogbG9jYWxTdG9yYWdlRmFjdG9yeSwgZGVwczogW0xvY2FsU3RvcmFnZVdyYXBwZXJdIH1cbiAgICBdXG59KVxuZXhwb3J0IGNsYXNzIE5ndFVuaXZlcnNhbE1vZHVsZSB7fVxuIl19